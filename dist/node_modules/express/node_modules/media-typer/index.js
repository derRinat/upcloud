/*!
 * media-typer
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */

function format(e){if(!e||typeof e!="object")throw new TypeError("argument obj is required");var t=e.parameters,n=e.subtype,r=e.suffix,i=e.type;if(!i||!typeNameRegExp.test(i))throw new TypeError("invalid type");if(!n||!subtypeNameRegExp.test(n))throw new TypeError("invalid subtype");var s=i+"/"+n;if(r){if(!typeNameRegExp.test(r))throw new TypeError("invalid suffix");s+="+"+r}if(t&&typeof t=="object"){var o,u=Object.keys(t).sort();for(var a=0;a<u.length;a++){o=u[a];if(!tokenRegExp.test(o))throw new TypeError("invalid parameter name");s+="; "+o+"="+qstring(t[o])}}return s}function parse(e){if(!e)throw new TypeError("argument string is required");typeof e=="object"&&(e=getcontenttype(e));if(typeof e!="string")throw new TypeError("argument string is required to be a string");var t=e.indexOf(";"),n=t!==-1?e.substr(0,t):e,r,i,s=splitType(n),o={},u;paramRegExp.lastIndex=t;while(i=paramRegExp.exec(e)){if(i.index!==t)throw new TypeError("invalid parameter format");t+=i[0].length,r=i[1].toLowerCase(),u=i[2],u[0]==='"'&&(u=u.substr(1,u.length-2).replace(qescRegExp,"$1")),o[r]=u}if(t!==-1&&t!==e.length)throw new TypeError("invalid parameter format");return s.parameters=o,s}function getcontenttype(e){if(typeof e.getHeader=="function")return e.getHeader("content-type");if(typeof e.headers=="object")return e.headers&&e.headers["content-type"]}function qstring(e){var t=String(e);if(tokenRegExp.test(t))return t;if(t.length>0&&!textRegExp.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(quoteRegExp,"\\$1")+'"'}function splitType(e){var t=typeRegExp.exec(e.toLowerCase());if(!t)throw new TypeError("invalid media type");var n=t[1],r=t[2],i,s=r.lastIndexOf("+");s!==-1&&(i=r.substr(s+1),r=r.substr(0,s));var o={type:n,subtype:r,suffix:i};return o}var paramRegExp=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,textRegExp=/^[\u0020-\u007e\u0080-\u00ff]+$/,tokenRegExp=/^[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/,qescRegExp=/\\([\u0000-\u007f])/g,quoteRegExp=/([\\"])/g,subtypeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,typeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,typeRegExp=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;exports.format=format,exports.parse=parse;