function parseAccept(e){return e.split(",").map(function(e,t){return parseMediaType(e.trim(),t)}).filter(function(e){return e})}function parseMediaType(e,t){var n=e.match(/\s*(\S+?)\/([^;\s]+)\s*(?:;(.*))?/);if(!n)return null;var r=n[1],i=n[2],s=""+r+"/"+i,o={},u=1;return n[3]&&(o=n[3].split(";").map(function(e){return e.trim().split("=")}).reduce(function(e,t){return e[t[0]]=t[1],e},o),o.q!=null&&(u=parseFloat(o.q),delete o.q)),{type:r,subtype:i,params:o,q:u,i:t,full:s}}function getMediaTypePriority(e,t){return t.map(function(t){return specify(e,t)}).filter(Boolean).sort(function(e,t){return e.s==t.s?e.q>t.q?-1:1:e.s>t.s?-1:1})[0]||{s:0,q:0}}function specify(e,t){var n=parseMediaType(e),r=0;if(!n)return null;if(t.type.toLowerCase()==n.type.toLowerCase())r|=4;else if(t.type!="*")return null;if(t.subtype.toLowerCase()==n.subtype.toLowerCase())r|=2;else if(t.subtype!="*")return null;var i=Object.keys(t.params);if(i.length>0){if(!i.every(function(e){return t.params[e]=="*"||(t.params[e]||"").toLowerCase()==(n.params[e]||"").toLowerCase()}))return null;r|=1}return{q:t.q,s:r}}function preferredMediaTypes(e,t){return e=parseAccept(e===undefined?"*/*":e||""),t?t.map(function(t){return[t,getMediaTypePriority(t,e)]}).filter(function(e){return e[1].q>0}).sort(function(e,t){var n=e[1],r=t[1];return r.q-n.q||r.s-n.s||n.i-r.i}).map(function(e){return e[0]}):e.sort(function(e,t){return t.q-e.q||e.i-t.i}).filter(function(e){return e.q>0}).map(function(e){return e.full})}module.exports=preferredMediaTypes,preferredMediaTypes.preferredMediaTypes=preferredMediaTypes;