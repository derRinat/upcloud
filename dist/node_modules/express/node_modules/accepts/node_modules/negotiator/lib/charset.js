function parseAcceptCharset(e){return e.split(",").map(function(e,t){return parseCharset(e.trim(),t)}).filter(function(e){return e})}function parseCharset(e,t){var n=e.match(/^\s*(\S+?)\s*(?:;(.*))?$/);if(!n)return null;var r=n[1],i=1;if(n[2]){var s=n[2].split(";");for(var t=0;t<s.length;t++){var o=s[t].trim().split("=");if(o[0]==="q"){i=parseFloat(o[1]);break}}}return{charset:r,q:i,i:t}}function getCharsetPriority(e,t){return t.map(function(t){return specify(e,t)}).filter(Boolean).sort(function(e,t){return e.s==t.s?e.q>t.q?-1:1:e.s>t.s?-1:1})[0]||{s:0,q:0}}function specify(e,t){var n=0;if(t.charset.toLowerCase()===e.toLowerCase())n|=1;else if(t.charset!=="*")return null;return{s:n,q:t.q}}function preferredCharsets(e,t){return e=parseAcceptCharset(e===undefined?"*":e||""),t?t.map(function(t){return[t,getCharsetPriority(t,e)]}).filter(function(e){return e[1].q>0}).sort(function(e,t){var n=e[1],r=t[1];return r.q-n.q||r.s-n.s||n.i-r.i}).map(function(e){return e[0]}):e.sort(function(e,t){return t.q-e.q||e.i-t.i}).filter(function(e){return e.q>0}).map(function(e){return e.charset})}module.exports=preferredCharsets,preferredCharsets.preferredCharsets=preferredCharsets;