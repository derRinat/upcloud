var Lab=require("lab"),Qs=require("../"),internals={},lab=exports.lab=Lab.script(),expect=Lab.expect,describe=lab.experiment,it=lab.test;describe("stringify()",function(){it("stringifies a querystring object",function(e){expect(Qs.stringify({a:"b"})).to.equal("a=b"),expect(Qs.stringify({a:1})).to.equal("a=1"),expect(Qs.stringify({a:1,b:2})).to.equal("a=1&b=2"),e()}),it("stringifies a nested object",function(e){expect(Qs.stringify({a:{b:"c"}})).to.equal("a%5Bb%5D=c"),expect(Qs.stringify({a:{b:{c:{d:"e"}}}})).to.equal("a%5Bb%5D%5Bc%5D%5Bd%5D=e"),e()}),it("stringifies an array value",function(e){expect(Qs.stringify({a:["b","c","d"]})).to.equal("a%5B0%5D=b&a%5B1%5D=c&a%5B2%5D=d"),e()}),it("omits array indices when asked",function(e){expect(Qs.stringify({a:["b","c","d"]},{indices:!1})).to.equal("a=b&a=c&a=d"),e()}),it("stringifies a nested array value",function(e){expect(Qs.stringify({a:{b:["c","d"]}})).to.equal("a%5Bb%5D%5B0%5D=c&a%5Bb%5D%5B1%5D=d"),e()}),it("stringifies an object inside an array",function(e){expect(Qs.stringify({a:[{b:"c"}]})).to.equal("a%5B0%5D%5Bb%5D=c"),expect(Qs.stringify({a:[{b:{c:[1]}}]})).to.equal("a%5B0%5D%5Bb%5D%5Bc%5D%5B0%5D=1"),e()}),it("does not omit object keys when indices = false",function(e){expect(Qs.stringify({a:[{b:"c"}]},{indices:!1})).to.equal("a%5Bb%5D=c"),e()}),it("stringifies a complicated object",function(e){expect(Qs.stringify({a:{b:"c",d:"e"}})).to.equal("a%5Bb%5D=c&a%5Bd%5D=e"),e()}),it("stringifies an empty value",function(e){expect(Qs.stringify({a:""})).to.equal("a="),expect(Qs.stringify({a:"",b:""})).to.equal("a=&b="),expect(Qs.stringify({a:null})).to.equal("a="),expect(Qs.stringify({a:{b:null}})).to.equal("a%5Bb%5D="),e()}),it("stringifies an empty object",function(e){var t=Object.create(null);t.a="b",expect(Qs.stringify(t)).to.equal("a=b"),e()}),it("returns an empty string for invalid input",function(e){expect(Qs.stringify(undefined)).to.equal(""),expect(Qs.stringify(!1)).to.equal(""),expect(Qs.stringify(null)).to.equal(""),expect(Qs.stringify("")).to.equal(""),e()}),it("stringifies an object with an empty object as a child",function(e){var t={a:Object.create(null)};t.a.b="c",expect(Qs.stringify(t)).to.equal("a%5Bb%5D=c"),e()}),it("drops keys with a value of undefined",function(e){expect(Qs.stringify({a:undefined})).to.equal(""),expect(Qs.stringify({a:{b:undefined,c:null}})).to.equal("a%5Bc%5D="),e()}),it("url encodes values",function(e){expect(Qs.stringify({a:"b c"})).to.equal("a=b%20c"),e()}),it("stringifies a date",function(e){var t=new Date,n="a="+encodeURIComponent(t.toISOString());expect(Qs.stringify({a:t})).to.equal(n),e()}),it("stringifies the weird object from qs",function(e){expect(Qs.stringify({"my weird field":"q1!2\"'w$5&7/z8)?"})).to.equal("my%20weird%20field=q1!2%22'w%245%267%2Fz8)%3F"),e()}),it("skips properties that are part of the object prototype",function(e){Object.prototype.crash="test",expect(Qs.stringify({a:"b"})).to.equal("a=b"),expect(Qs.stringify({a:{b:"c"}})).to.equal("a%5Bb%5D=c"),delete Object.prototype.crash,e()}),it("stringifies boolean values",function(e){expect(Qs.stringify({a:!0})).to.equal("a=true"),expect(Qs.stringify({a:{b:!0}})).to.equal("a%5Bb%5D=true"),expect(Qs.stringify({b:!1})).to.equal("b=false"),expect(Qs.stringify({b:{c:!1}})).to.equal("b%5Bc%5D=false"),e()}),it("stringifies buffer values",function(e){expect(Qs.stringify({a:new Buffer("test")})).to.equal("a=test"),expect(Qs.stringify({a:{b:new Buffer("test")}})).to.equal("a%5Bb%5D=test"),e()}),it("stringifies an object using an alternative delimiter",function(e){expect(Qs.stringify({a:"b",c:"d"},{delimiter:";"})).to.equal("a=b;c=d"),e()}),it("doesn't blow up when Buffer global is missing",function(e){var t=global.Buffer;delete global.Buffer,expect(Qs.stringify({a:"b",c:"d"})).to.equal("a=b&c=d"),global.Buffer=t,e()})});