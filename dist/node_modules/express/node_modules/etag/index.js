/*!
 * etag
 * Copyright(c) 2014 Douglas Christopher Wilson
 * MIT Licensed
 */

function etag(e,t){if(e==null)throw new TypeError("argument entity is required");var n=isstats(e),r=t&&typeof t.weak=="boolean"?t.weak:n;if(n)return stattag(e,r);if(typeof e!="string"&&!Buffer.isBuffer(e))throw new TypeError("argument entity must be string, Buffer, or fs.Stats");var i=r?weakhash(e):stronghash(e);return r?'W/"'+i+'"':'"'+i+'"'}function isstats(e){return e===null||typeof e!="object"?!1:e instanceof Stats?!0:"atime"in e&&toString.call(e.atime)==="[object Date]"&&"ctime"in e&&toString.call(e.ctime)==="[object Date]"&&"mtime"in e&&toString.call(e.mtime)==="[object Date]"&&"ino"in e&&typeof e.ino=="number"&&"size"in e&&typeof e.size=="number"}function stattag(e,t){var n=e.mtime.toISOString(),r=e.size.toString(16);if(t)return'W/"'+r+"-"+crc(n)+'"';var i=crypto.createHash("md5").update("file","utf8").update(NULL).update(r,"utf8").update(NULL).update(n,"utf8").digest("base64");return'"'+i+'"'}function stronghash(e){return e.length===0?"1B2M2Y8AsgTpgAmY7PhCfg==":crypto.createHash("md5").update(e,"utf8").digest("base64")}function weakhash(e){if(e.length===0)return"0-0";var t=typeof e=="string"?Buffer.byteLength(e,"utf8"):e.length;return t<=crc32threshold?t.toString(16)+"-"+crc(e).toString(16):crypto.createHash("md4").update(e,"utf8").digest("base64")}module.exports=etag;var crc=require("crc").crc32,crypto=require("crypto"),Stats=require("fs").Stats,crc32threshold=1e3,NULL=new Buffer([0]),toString=Object.prototype.toString;